id: EQ_CRYSTALLINE_VELDTS
type: BIOME
abstract: true

vars: &variables
  base: ${options.yml:bedrock-top-y} - 20
  bedrockTop: $options.yml:bedrock-top-y
  netherTop: $options.yml:nether-top-y

terrain:
  sampler:
    type: EXPRESSION
    dimensions: 3
    variables: *variables
    expression: |
      if (y > bedrockTop, -1,
        if (y > netherTop, y,
          max(
            //Nether sealed ground and lower terrain
            max(
            
              //Generally flat lower ground
              (-((y / 24)^2) + 1 + |(simplex2(x, z) / 2) + 0.1|),
              
              //CV terrain
              stepLipped(-y + 64, 1/6, 96, 0, 0) + simplex2(x, z)*120
              
            ),
            
            //Nether sealed ground and higher terrain
            max(
            
              //CV terrain upside down
              -(stepLipped(-y + 228, 1/9, 196, 0, 0) + simplex2(x, z)*120),
              
              //Generally flat higher ground
              -(-((y / 24)^2) + 108 + |(simplex2(x, z) / 2) + 0.1|)
              
            )
          )
        )
      )

  sampler-2d:
    dimensions: 2
    type: CONSTANT